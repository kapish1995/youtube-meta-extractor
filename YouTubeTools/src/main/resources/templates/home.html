<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube SEO Tag Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#2563eb',
                            600: '#1d4ed8',
                            700: '#1d4ed8'
                        },
                        accent: '#22c55e'
                    }
                }
            }
        }
    </script>
    <style>
        .main-title {
            background: linear-gradient(90deg, #2563eb, #22c55e);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .gradient-header {
            background: linear-gradient(135deg, rgba(37,99,235,.08), rgba(34,197,94,.08));
            border: 1px dashed #e2e8f0;
        }
        .tag {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid #e2e8f0;
            transition: transform .1s ease, background .2s ease;
        }
        .tag:hover {
            transform: translateY(-1px);
            background: rgba(34, 197, 94, 0.22);
        }
        .error {
            background: rgba(239, 68, 68, 0.12);
            color: #ef4444;
            border-left: 4px solid #ef4444;
        }
        .success {
            background: rgba(16, 185, 129, 0.12);
            color: #10b981;
            border-left: 4px solid #10b981;
        }
        .dark .gradient-header {
            border-color: #334155;
        }
        .dark .tag {
            border-color: #334155;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen transition-colors duration-300 dark:bg-slate-900 dark:text-slate-100">

<!-- Navbar -->
<div th:replace="~{fragments/navbar :: navbar}" th:with="activePage='seo'"></div>

<!-- Main Container -->
<div class="container mx-auto px-4 max-w-2xl mt-12 pb-12">

    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="main-title text-4xl md:text-5xl font-extrabold mb-4">YouTube SEO Tag Generator</h1>
        <div class="gradient-header rounded-xl p-4 mt-6">
            <p class="text-slate-600 dark:text-slate-400 text-lg mb-0">
                Enter a YouTube video title to find and extract SEO tags from similar videos to optimize your content.
            </p>
        </div>
    </div>

    <!-- Form Section -->
    <div class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg p-6 mb-8">
        <form id="searchForm">
            <div class="mb-6 text-start">
                <label for="videoTitle" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                    YouTube Video Title
                </label>
                <input
                        type="text"
                        id="videoTitle"
                        name="videoTitle"
                        class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:focus:ring-blue-800 transition-colors duration-200"
                        placeholder="Enter the title of your YouTube video"
                        required>
            </div>
            <button
                    type="submit"
                    id="searchBtn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg shadow-lg transition-colors duration-200 flex items-center justify-center gap-2">
                <span class="text-xl">&#43;</span> Generate SEO Tags
            </button>
        </form>

        <!-- Loading & Error Messages -->
        <div id="loading" class="hidden text-center py-4 text-slate-600 dark:text-slate-400">Searching for video tags...</div>
        <div id="error" class="error hidden rounded-lg p-4 mb-4"></div>
    </div>

    <!-- Results -->
    <div id="results"></div>

    <!-- Copy Success Message -->
    <div id="copySuccess" class="success hidden rounded-lg p-4 mb-4">Tags copied to clipboard!</div>
</div>

<!-- JavaScript -->
<script>
    const form = document.getElementById('searchForm');
    const videoTitleInput = document.getElementById('videoTitle');
    const loading = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const resultsDiv = document.getElementById('results');
    const copySuccess = document.getElementById('copySuccess');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        errorDiv.classList.add('hidden');
        resultsDiv.innerHTML = '';
        copySuccess.classList.add('hidden');
        loading.classList.remove('hidden');

        const videoTitle = videoTitleInput.value.trim();

        try {
            const res = await fetch('/api/youtube/search', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ videoTitle })
            });

            const data = await res.json();
            loading.classList.add('hidden');

            if (!res.ok) {
                errorDiv.textContent = data.message || 'An error occurred. Please try again.';
                errorDiv.classList.remove('hidden');
                return;
            }

            renderResults(data);

        } catch (err) {
            loading.classList.add('hidden');
            errorDiv.textContent = 'An error occurred. Please try again.';
            errorDiv.classList.remove('hidden');
        }
    });

    function renderResults(data) {
        let html = '';

        if (!data.primaryVideo && (!data.relatedVideos || data.relatedVideos.length === 0)) {
            html = '<div class="error rounded-lg p-4">No tags found for this video. Try a different title or check your API key.</div>';
            resultsDiv.innerHTML = html;
            return;
        }

        // Primary Video Tags
        if (data.primaryVideo && data.primaryVideo.tags.length > 0) {
            html += `
            <div class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2 font-bold text-slate-900 dark:text-slate-100">
                        <i class="bi bi-star-fill text-blue-500"></i> <span>Primary Video Tags</span>
                    </div>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center gap-2" onclick="copyTags('${data.primaryVideo.tags.join(", ").replace(/'/g, "&#39;")}')">
                        <i class="bi bi-clipboard2-check"></i> Copy Tags
                    </button>
                </div>
                <div class="text-slate-600 dark:text-slate-400 mb-4">
                    ${data.primaryVideo.title}
                    <span class='ml-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600 rounded-full px-3 py-1 text-xs'>
                        ${data.primaryVideo.channelTitle}
                    </span>
                </div>
                <div>${data.primaryVideo.tags.map(tag => `<span class='tag inline-flex items-center gap-2 rounded-full px-3 py-2 mr-2 mb-2 text-sm'><i class='bi bi-hash'></i>${tag}</span>`).join('')}</div>
            </div>`;
        }

        // Related Videos Tags
        if (data.relatedVideos && data.relatedVideos.length > 0) {
            const allTags = Array.from(new Set([
                ...(data.primaryVideo ? data.primaryVideo.tags : []),
                ...data.relatedVideos.flatMap(v => v.tags || [])
            ]));

            html += `
            <div class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2 font-bold text-slate-900 dark:text-slate-100">
                        <i class="bi bi-collection text-blue-500"></i> <span>Related Videos Tags</span>
                    </div>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 flex items-center gap-2" onclick="copyTags('${allTags.join(", ").replace(/'/g, "&#39;")}')">
                        <i class="bi bi-clipboard2"></i> Copy All
                    </button>
                </div>
                <div class="mt-4">`;

            data.relatedVideos.forEach(video => {
                html += `
                <div class='mb-6'>
                    <div class='font-semibold text-slate-900 dark:text-slate-100 mb-2'>
                        <i class='bi bi-play-btn mr-2 text-blue-500'></i>${video.title}
                        <span class='ml-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600 rounded-full px-3 py-1 text-xs'>
                            ${video.channelTitle}
                        </span>
                    </div>
                    <div>${
                        (video.tags && video.tags.length > 0)
                        ? video.tags.map(tag => `<span class='tag inline-flex items-center gap-2 rounded-full px-3 py-2 mr-2 mb-2 text-sm'><i class='bi bi-tag'></i>${tag}</span>`).join('')
                        : '<span class="text-slate-500 dark:text-slate-400 italic">No tags found</span>'
                    }</div>
                </div>`;
            });

            html += `</div></div>`;
        }

        resultsDiv.innerHTML = html;
    }

    window.copyTags = function(tags) {
        navigator.clipboard.writeText(tags)
            .then(() => {
                copySuccess.classList.remove('hidden');
                setTimeout(() => { copySuccess.classList.add('hidden'); }, 2000);
            })
            .catch(() => {
                alert('Could not copy tags.');
            });
    };
</script>
</body>